{{ block title }}
    å›åˆ {{ world_round }} / 5
{{ endblock }}

{{ block content }}
<p><strong>ä½ æ˜¯ <u>ç©å®¶ {{ player.id_in_group }}</u>ã€‚</strong></p>

<!-- çŠ¶å†µä¿¡æ¯ -->
<div class="card mb-3">
    <div class="card-header">
        <h5>çŠ¶å†µä¿¡æ¯</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col">
                <p>ç¬¬ {{ world_round }} å›ï¼ˆå…± 5 å›ï¼‰</p>
                <p>å½“å‰äººç”Ÿç§¯åˆ†: <strong>{{ current_points }}</strong> ç‚¹</p>

                <div class="alert alert-info">
                    <p><strong>ğŸ’° æœ¬å›åˆä½ è·å¾—äº† {{ round_allowance }} äººç”Ÿç§¯åˆ†ï¼</strong></p>
                    <p>å½“å‰äººç”Ÿç§¯åˆ†: <strong>{{ current_points }}</strong> ç‚¹</p>
                    <small class="text-muted">(ä¸Šå›: {{ previous_points }} + æœ¬å›: {{ round_allowance }})</small>
                </div>

                {% if current_effort %}
                    <p class="text-success">âœ… æœ¬å›åˆå­¦ä¹ æ—¶é—´: <strong>{{ current_effort }} å°æ—¶</strong></p>
                {% else %}
                    <p class="text-warning">âš ï¸ ä½ è¿˜æ²¡æœ‰é€‰æ‹©æœ¬å›åˆçš„å­¦ä¹ æ—¶é—´ã€‚</p>
                {% endif %}

                {% if previous_effort and player.round_number not in [1, 6] %}
                    <p class="text-muted">ï¼ˆä¸Šå›å­¦ä¹ æ—¶é—´: {{ previous_effort }} å°æ—¶ï¼‰</p>
                {% endif %}

                {% if previous_round_rank and player.round_number not in [1, 6] %}
                    <h5 class="text-primary fw-bold mt-3">
                        ğŸ“Š ä¸Šå›å›åˆä¸­çš„ä½ çš„å­¦ä¹ æˆç»©æ’åæ˜¯ <strong>{{ previous_round_rank }} ä½</strong>ã€‚
                    </h5>
                {% endif %}

                <p class="text-info">ğŸ“š ç´¯è®¡å­¦ä¹ æ—¶é—´: <strong>{{ current_total_hours }} å°æ—¶</strong></p>
            </div>
        </div>
    </div>
</div>

<!-- å­¦ä¹ æ—¶é—´é€‰æ‹© -->
<div class="card mb-3">
    <div class="card-header">
        <h5>é€‰æ‹©å­¦ä¹ æ—¶é—´</h5>
    </div>
    <div class="card-body">
        <p>
            æ¯å›åˆå¼€å§‹æ—¶ä½ ä¼šè·å¾— <strong>{{ round_allowance }} ç‚¹</strong>äººç”Ÿç§¯åˆ†ã€‚<br>
            å­¦ä¹ æ—¶é—´è¶Šé•¿ï¼Œå­¦ä¹ æˆæœ¬å°†æŒ‰ç…§ä¸‹è¡¨å¢åŠ ã€‚
        </p>

        <!-- å¯ç‚¹å‡»çš„å­¦ä¹ æˆæœ¬è¡¨ -->
        {% if cost_table %}
        <div class="mt-3">
            <h6>å­¦ä¹ æ—¶é—´ä¸æˆæœ¬è¡¨ï¼ˆç‚¹å‡»é€‰æ‹©ï¼‰:</h6>
            <div class="d-flex flex-wrap gap-3 mt-3">
                {% for item in cost_table %}
                <div class="effort-card btn btn-outline-primary p-3 text-center position-relative"
                     data-effort="{{ item.hours }}">
                    <h5 class="mb-1">{{ item.hours }} å°æ—¶</h5>
                    <p class="mb-0 text-muted">{{ item.cost }} ç‚¹</p>
                    <!-- âœ… é€‰ä¸­æ ‡å¿— -->
                    <div class="checkmark">âœ…</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- éšè—çš„è¾“å…¥æ¡†ï¼Œç”¨äºä¿å­˜é€‰æ‹©çš„æ—¶é—´ -->
        <input type="hidden" name="effort" id="effort-input">

        <p class="mt-3 text-muted">â€» è¯·ç‚¹å‡»é€‰æ‹©å­¦ä¹ æ—¶é—´ã€‚</p>
    </div>
</div>

{{ next_button }}

<!-- æ ·å¼ + åŠ¨ç”» -->
<style>
.effort-card {
    cursor: pointer;
    transition: all 0.15s ease-in-out;
    width: 110px;
}
.effort-card:hover {
    transform: scale(1.05);
}
.effort-card.active {
    background-color: #007bff;
    color: white;
    border-color: #0056b3;
    box-shadow: 0 0 12px rgba(0, 123, 255, 0.6);
    transform: scale(1.1);
}
.effort-card .checkmark {
    position: absolute;
    top: 8px;
    right: 10px;
    font-size: 1.3em;
    display: none;
}
.effort-card.active .checkmark {
    display: block;
    animation: pop 0.25s ease;
}
@keyframes pop {
    0% { transform: scale(0); opacity: 0; }
    80% { transform: scale(1.3); opacity: 1; }
    100% { transform: scale(1); }
}
</style>

<!-- è„šæœ¬ -->
<script>
    const cards = document.querySelectorAll('.effort-card');
    const input = document.getElementById('effort-input');

    cards.forEach(card => {
        card.addEventListener('click', () => {
            // æ¸…é™¤é«˜äº®
            cards.forEach(c => c.classList.remove('active'));
            // é«˜äº®å½“å‰
            card.classList.add('active');
            // è®°å½•é€‰æ‹©å€¼
            input.value = card.dataset.effort;
        });
    });

    // æœªé€‰ç¦æ­¢æäº¤
    document.querySelector('form').addEventListener('submit', e => {
        if (!input.value) {
            e.preventDefault();
            alert("è¯·é€‰æ‹©å­¦ä¹ æ—¶é—´ã€‚");
            return false;
        }
        sessionStorage.setItem('effort_submitted', 'true');
    });
</script>
{{ endblock }}
